{% extends 'base.html' %}{% block content %}<h2>Server</h2><section class='grid-2'><div class='card'><h3>ACL (UFW allowlist)</h3><form method='post' action='/acl/add' class='grid-3'><label>Port <input type='number' name='port' placeholder='22/8080/80/443' required></label><label>CIDR/IP <input type='text' name='cidr' placeholder='x.x.x.x[/mask]' required></label><div><button type='submit'>Add rule</button></div></form><form method='post' action='/acl/apply'><table id='tbl-acl'><thead><tr><th onclick="sortTable('tbl-acl',0)">Port</th><th onclick="sortTable('tbl-acl',1)">Proto</th><th onclick="sortTable('tbl-acl',2)">CIDR</th><th onclick="sortTable('tbl-acl',3)">Enabled</th><th>Actions</th></tr></thead><tbody>{% for a in acls %}<tr><td>{{a.port}}</td><td>{{a.proto}}</td><td class='mono'>{{a.cidr}}</td><td>{{'yes' if a.enabled else 'no'}}</td><td class='actions'><form method='post' action='/acl/{{a.id}}/toggle'><button>Toggle</button></form><form method='post' action='/acl/{{a.id}}/delete'><button>Delete</button></form></td></tr>{% endfor %}</tbody></table><button type='submit'>Apply to UFW</button><div class='muted'>Текущий IP добавится автоматически для SSH и порта панели.</div></form></div><div class='card'><h3>TLS (Let's Encrypt)</h3><form method='post' action='/tls/generate' class='grid-3'><label>Hostname (FQDN) <input type='text' name='hostname' placeholder='vpn.example.com' required></label><label>Email (LE) <input type='email' name='email' placeholder='you@example.com' required></label><div><button>Generate script</button></div></form><div class='muted'>Скрипт появится в <code>/opt/myst-manager/app/generated/</code>. Выполни от root.</div></div></section><div class='card'><h3>Diagnostics</h3><div class='bar'><a class='btn' href='/metrics' target='_blank'>Prometheus /metrics</a><a class='btn' href='/backup_db' target='_blank'>Backup DB</a></div></div><script>function sortTable(tableId,colIndex){const table=document.getElementById(tableId);const tbody=table.tBodies[0];const rows=Array.from(tbody.querySelectorAll('tr'));const isNumeric=(v)=>/^-?\d+(\.\d+)?$/.test(v);const get=(tr)=>(tr.children[colIndex].innerText||'').trim();const asc=table.getAttribute('data-sort-dir')!=='asc';rows.sort((a,b)=>{const av=get(a),bv=get(b);if(isNumeric(av)&&isNumeric(bv))return (parseFloat(av)-parseFloat(bv))*(asc?1:-1);return av.localeCompare(bv)*(asc?1:-1);});rows.forEach(r=>tbody.appendChild(r));table.setAttribute('data-sort-dir',asc?'asc':'desc');}</script>{% endblock %}